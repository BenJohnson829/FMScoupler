<HTML>
<TITLE>program coupler_main</TITLE>
<BODY BGCOLOR="#AABBCC" TEXT="#332211" >

<DIV ALIGN="CENTER"> <FONT SIZE=1>
<A HREF="#INTERFACE">PUBLIC INTERFACE</A> / 
<A HREF="#NAMELIST">NAMELIST</A> / 
<A HREF="#CHANGES">CHANGES</A> / 
<A HREF="#ERRORS">ERRORS</A> / 
<A HREF="#NOTES">NOTES</A> 
</FONT>
<P><I>Last updated on <!--#exec cmd="echo $LAST_MODIFIED" -->.</I>
<BR><BR></DIV><HR>


<H2>program coupler_main</H2>
<A NAME="HEADER">
<PRE>
     Version: v2.1
     Date:    November 30, 1999
     Contact: Bruce Wyman
</PRE>
</A><!-- END HEADER -->
<!--------------------------------------------------------------------->
<A NAME="OVERVIEW">
<HR>
<H4>OVERVIEW</H4>
<!-- BEGIN OVERVIEW -->
<PRE>

     A main program that couples component models (atmosphere, ocean,
     land, and ice) on different grids using the interpolation
     algorithm of the exchange grid module.

</PRE>
</A><!-- END OVERVIEW -->
<!--------------------------------------------------------------------->
<A NAME="DESCRIPTION">
<!-- BEGIN DESCRIPTION -->
<PRE>
     This version couples an atmospheric GCM to other component
     models using a common grid (the atmospheric grid). The atmospheric
     model grid is initialized first, and then used for the other
     component models. This version is suitable for AMIP-type runs.

     The component models are coupled to allow implicit vertical
     diffusion of heat and moisture at the interfaces of the atmosphere,
     land, and ice models. As a result, the atmosphere, land, and ice 
     models all use the same time step.  The atmospheric model has been
     separated into down and up calls that correspond to the down and up
     sweeps of the standard tridiagonal elimination.

     The ocean interface uses explicit mixing.  Fluxes to and from
     the ocean must be passed through the ice model to interact with
     the atmosphere.

     This program contains the model's main time loop. Each iteration 
     of the main time loop is one ocean (slow) time step.  Within this
     slow time step loop is a fast time step loop, using the
     atmospheric time step, where the tridiagonal vertical diffusion
     equations are solved. 


  MAIN PROGRAM EXAMPLE
  --------------------

     DO slow time steps (ocean)

          call flux_ocean_to_ice

          call ICE_BOT_to_ICE_TOP

          DO fast time steps (atmos)

               call flux_calculation

               call ATMOS_DOWN

               call flux_down_from_atmos

               call LAND_FAST

               call ICE_FAST

               call flux_up_to_atmos

               call ATMOS_UP

          END DO

          call ICE_SLOW

          call flux_ice_to_ocean

          call OCEAN

     END DO

</PRE>
</A><!-- END DESCRIPTION -->
<!--------------------------------------------------------------------->
<A NAME="MODULES_USED">
<HR>
<H4>OTHER MODULES USED</H4>
<!-- BEGIN MODULES_USED -->
<PRE>

    atmos_coupled_mod
    ocean_coupled_mod
       land_model_mod
        ice_model_mod
    flux_exchange_mod
     time_manager_mod
        utilities_mod

</PRE>
</A><!-- END MODULES_USED -->
<!--------------------------------------------------------------------->
<A NAME="INTERFACE">
<HR>
<H4>PUBLIC INTERFACE</H4>
<!-- BEGIN INTERFACE -->
<PRE>

   This is a main program. There are no callable interfaces.

   A namelist interface called <b>&coupler_nml</b> must reside
   in file <b>coupler.nml</b>. See the details below.

</PRE>
</A><!-- END INTERFACE -->
<!--------------------------------------------------------------------->
<A NAME="NAMELIST">
<HR>
<H4>NAMELIST</H4>
<!-- BEGIN NAMELIST -->
<PRE>

<b>&coupler_nml</b>

  current_date  The date that the current integration starts with.
                  [integer, dimension(6), default: current_date=0]

  override      Flag that determines whether the namelist variable
                current_date should override the date in the
                restart file INPUT/coupler.res. If the restart file
                does not exist then override has not effect, the
                value of current_date will be used.
                  [logical, default: override=false]

  calendar      The calendar type used by the current integration.
                Valid values are consistent with the time_manager
                module: 'julian', 'no_leap', or 'thirty_day'.
                The value 'no_calendar' can not be used because
                the time_manager's date function are used.
                All values must be lowercase.
                  [ character(maxlen=17), default: calendar=' ' ]


  months        The number of months that the current integration will
                be run for.   [integer, default: months=0]

  days          The number of days that the current integration will
                be run for.   [integer, default: days=0]

  hours         The number of hours that the current integration will
                be run for.   [integer, default: hours=0]

  minutes       The number of minutes that the current integration will
                be run for.   [integer, default: minutes=0]

  seconds       The number of seconds that the current integration will
                be run for.   [integer, default: seconds=0]


  dt_atmos      Time step in seconds for the fast-atmospheric portion
                of the main time loop.  
                   [integer, default: dt_atmos=0]

  dt_ocean      Time step in seconds for the slow-ocean-ice portion
                of the main time loop.
                   [integer, default: dt_ocean=0]

  Notes:

    1) If no value is set for current_date, start_date, or calendar
       (or default value specified) then the value from restart
       file "INPUT/coupler.res" will be used. If neither a namelist
       value or restart file value exist the program will fail.

    2) The actual run length will be the sum of months, days, hours,
       minutes, and seconds.  A run length of zero is not a valid option.

    3) The ocean time step (dt_ocean) must be an integer multiple of
       the run length (see 2).  The atmosphere time step (dt_atmos)
       must be an integer multiple of the ocean time step.

</PRE>
</A><!-- END NAMELIST -->
<!--------------------------------------------------------------------->
<A NAME="CHANGES">
<HR>
<H4>CHANGE HISTORY</H4>
<!-- BEGIN CHANGES -->
<PRE>

<b>changes for v2.1</b>

   * Added calls to timing routines. 
   * Fixed a small bug when checking the existence of the 
     output restart directory.
   * Renamed the use of atmos_model and ocean_model to
     atmos_coupled and ocean_coupled.
   * Changed the use name of component model derived-type data
     from ..._data_type to ..._boundary_data_type.

</PRE>
</A><!-- END CHANGES -->
<!--------------------------------------------------------------------->
<A NAME="ERRORS">
<HR>
<H4>ERROR MESSAGES</H4>
<!-- BEGIN ERRORS -->
<PRE>

<b>FATAL ERRORS in program coupler_main</b>

    <b>invalid namelist value for calendar</b>
        The value of calendar must be 'julian', 'no_leap', or 'thirty_day'.
        See the namelist documentation.

    <b>no namelist value for calendar</b>
        If no restart file is present, then a namelist value for
        calendar must be specified.

    <b>initial time is greater than current time</b>
        If a restart file is present, then the namelist value for either
        current_date or start_date was incorrectly set.

    <b>run length must be multiple of ocean time step</b>
        There must be an even number of ocean time steps for the
        requested run length.

    <b>ocean time step is not a multiple of the atmosphere time step</b>
        There must be an even number of fast atmospheric time steps 
        for the length of one slow ocean time step.

<b>WARNINGS in program coupler_main</b>

    <b>final time does not match expected ending time</b>
        This error should probably not occur because of checks done at
        initialization time.

</PRE>
</A><!-- END ERRORS -->
<!--------------------------------------------------------------------->
<A NAME="BUGS">
<HR>
<H4>KNOWN BUGS</H4>
<!-- BEGIN BUGS -->
<PRE>

     None.

</PRE>
</A><!-- END BUGS -->
<!--------------------------------------------------------------------->
<A NAME="NOTES">
<HR>
<H4>NOTES</H4>
<!-- BEGIN NOTES -->
<PRE>

     None.

</PRE>
</A><!-- END NOTES -->
<!--------------------------------------------------------------------->
<A NAME="PLANS">
<HR>
<H4>FUTURE PLANS</H4>
<!-- BEGIN PLANS -->
<PRE>

   1) A fully-coupled version (potentially on different grids).

   2) Interface with a "fast-ocean" routine in the fast atmos-land-ice
      part of the integration loop.

   3) Introduce a multiple time-step loop into the slow ocean-ice
      part of the integration loop.

   4) Interface with a more complex ice and land model.

</PRE>
</A><!-- END PLANS -->
<!--------------------------------------------------------------------->

<HR>
</BODY>
</HTML>
